# 项目中遇到的问题

## React 项目中出现的性能问题

需求是一个创建的任务，类似一个大表单，字段有几十个字段

从UI设计和需求上看，最开始是可以分为4个小一点的表单，因为是相互独立的，只是需要按步骤进行

所以最开始的设计就是多个表单来实现，刚好我们用的Antd Form 有个 Provider 组件，能管理多个表单

就直接使用 Form.Provider + 多表单来实现

需求的变动，表单之间需要联动，比如 第二个表单的某些字段需要依赖第一个表单的字段，或者后一个表单的某几个下拉数据源依赖多个字段且包括其他表单的字段

表单之间出现了数据的流通，开始考虑共享状态，最后我们加入了 context

需求进一步发展，出现了嵌套表单，多层嵌套，因为还需要从外部引入共用组件，外部的组件也是表单

再然后，动态表单也出现了，又加入了 Form.Lis

以及需要根据某个表单的内容，动态创建出多个表单，且表单的内容是根据某个表单的内容动态分配的，最多能创建出十几二十个这样的表单

最后的结果是 表单过多的时候出现卡顿，比如在深层的表单输入时，更新的延迟

原因：
数据依赖过重，且 Form.Provider 和 context 导致深层表单的变动会导致其他表单的更新，更新频繁导致的卡顿延迟

考虑的解决方案：

- Form.Provider 移除，通过 value 和 onChange 自己实现表单的数据绑定

- 对于用了 context 的组件，React.memo 做更新优化

- 删除多余的 useCallback useMemo 缓存消耗性能


另外表单的复杂程度来源于：
- 数据之间互相依赖，比如一个下拉框数据源，依赖于多个表单的字段
- 默认值的更新冲突，多次设置默认值，比如 创建表单时 undefined，单选第一个作为默认值，接口获取的默认值，复制时候的值



















